#Hunting down a Hiesenbug - part 1/2

<p>Let me just get right to it: I've encountered a Hiesenbug and it's been driving me crazy trying to figure it out. A "Hiesenbug" as they call it, is a bug that, once being inspected in a debugger, seems to disappear. Here's my situation (the hope is that problem solving this outloud will help me to find a solution):
<p>I don't want to get too technical with the details of the code, but basically I wrote a patch which enables the New Tab page in Firefox to run in mutliprocess[1] and when I ran the tests on it for the first time, there were some failures. Naturally, the next step was to attach the JS debugger to the test, set a breakpoint where the failure was happening and step through to see what was going on. So I attach the debugger, I set my breakpoint, I hit the breakpoint, I step through the code with the debugger, and all of a sudden I get to the end of the test without any failures. 
<p>Ok...sanity check: run the test again without the debugger, maybe it'll pass this time? That's not the case, I'm still getting a failure. So I try again with the debugger attached. And the test passes. 
<p>What is going on? The test only seems to pass when the debugger is attached to it, but how does that make sense? And how do you debug something if as soon as you try to debug it, the problem goes away?
<p>At this point a couple different ideas are going through my mind. If I can't debug with an IDE I'll have to do it the good old fashioned way and use dump statements to see where the failure is happening. So for a little context; the test itself is pretty simple. It checks the layout of a grid on the page by assigning each box of the grid an index and then making sure that box is at the right index. It does that by comparing the grid you've passed in's box index with the expected grid's box index and making sure they are identical. So I dump out the grid that we're passing in to make sure it's grabbing the correct grid and the correct values. But the output from the dump statement for the grid comes out empty - which means the grid is returning empty indexes.
<p>So obviously our grid layout: [,,,,,,,] /= expected grid layout: [0,1,2,3,4,5,6,7,8]. (ADD LOTS OF PHOTOS AND CODE TO HELP MAKE SENSE OF THIS)
<p>The strange part is that if I set a break point <i>right before</i> we get the grid layout, and run the test with the debugger attached, the debugger wil tell me that our grid layout is actually [0,1,2,3,4,5,6,7,8] and so the test will pass.
<p>There are inconsistencies with what the debugger thinks the grid is, and what the grid <i>actually</i> is when I run the test alone. Is the debugger unreliable? Does it have access to a different scope that perhaps the test has? Is it doing some kind of strange code manipulation when you step through it which is influencing the results of the test? And what is causing it do be inconsistent this way?





[1] If you're interested in multiprocess Firefox (also known as Electrolysis), you can read more about it right here, and also right here. I'm currently doing a summer internship at Mozilla, working on multiprocess Firefox (stay tuned for a post about my summer at Mozilla!).